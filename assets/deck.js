/*!
Deck JS - deck.core
Copyright (c) 2011 Caleb Troughton
Dual licensed under the MIT license and GPL license.
https://github.com/imakewebthings/deck.js/blob/master/MIT-license.txt
https://github.com/imakewebthings/deck.js/blob/master/GPL-license.txt
*//*
The deck.core module provides all the basic functionality for creating and
moving through a deck.  It does so by applying classes to indicate the state of
the deck and its slides, allowing CSS to take care of the visual representation
of each state.  It also provides methods for navigating the deck and inspecting
its state, as well as basic key bindings for going to the next and previous
slides.  More functionality is provided by wholly separate extension modules
that use the API provided by core.
*/(function(e,t,n,r){var i,s,o,u={change:"deck.change",beforeInitialize:"deck.beforeInit",initialize:"deck.init"},a={},f=e(n),l=function(){var t=a.classes,n=a.selectors.container,r=o.data("onSlide"),u=e();o.removeClass(t.onPrefix+r).addClass(t.onPrefix+s).data("onSlide",s);e("."+t.current).parentsUntil(n).removeClass(t.childCurrent);i[s].parentsUntil(n).addClass(t.childCurrent);e.each(i,function(e,t){u=u.add(t)});u.removeClass([t.before,t.previous,t.current,t.next,t.after].join(" "));i[s].addClass(t.current);s>0&&i[s-1].addClass(t.previous);s+1<i.length&&i[s+1].addClass(t.next);s>1&&e.each(i.slice(0,s-1),function(e,n){n.addClass(t.before)});s+2<i.length&&e.each(i.slice(s+2),function(e,n){n.addClass(t.after)})},c={init:function(n,h){var p,d,v=function(e){e.stopPropagation()};a=e.extend(!0,{},e[t].defaults,h);i=[];s=0;o=e(a.selectors.container);d=a.touch.swipeTolerance;f.trigger(u.beforeInitialize);o.addClass(a.classes.loading);e.isArray(n)?e.each(n,function(t,n){i.push(e(n))}):e(n).each(function(t,n){i.push(e(n))});f.unbind("keydown.deck").bind("keydown.deck",function(t){if(t.which===a.keys.next||e.inArray(t.which,a.keys.next)>-1){c.next();t.preventDefault()}else if(t.which===a.keys.previous||e.inArray(t.which,a.keys.previous)>-1){c.prev();t.preventDefault()}}).undelegate("input, textarea, select, button, meter, progress, [contentEditable]","keydown",v).delegate("input, textarea, select, button, meter, progress, [contentEditable]","keydown",v);o.unbind("touchstart.deck").bind("touchstart.deck",function(t){p||(p=e.extend({},t.originalEvent.targetTouches[0]))}).unbind("touchmove.deck").bind("touchmove.deck",function(n){e.each(n.originalEvent.changedTouches,function(n,i){if(p&&i.identifier===p.identifier){if(i.screenX-p.screenX>d||i.screenY-p.screenY>d){e[t]("prev");p=r}else if(i.screenX-p.screenX<-1*d||i.screenY-p.screenY<-1*d){e[t]("next");p=r}return!1}});n.preventDefault()}).unbind("touchend.deck").bind("touchend.deck",function(t){e.each(t.originalEvent.changedTouches,function(e,t){p&&t.identifier===p.identifier&&(p=r)})}).scrollLeft(0).scrollTop(0);e.each(i,function(n,r){r.unbind("webkitTransitionEnd.deck").bind("webkitTransitionEnd.deck",function(n){if(r.hasClass(e[t]("getOptions").classes.current)){var i=e(this).find("iframe").css("opacity",0);window.setTimeout(function(){i.css("opacity",1)},100)}})});i.length&&l();o.removeClass(a.classes.loading);f.trigger(u.initialize)},go:function(t){var n=e.Event(u.change),r;typeof t=="number"&&t>=0&&t<i.length?r=t:typeof t=="string"&&e.each(i,function(e,n){if(n.attr("id")===t){r=e;return!1}});if(typeof r=="undefined")return;f.trigger(n,[s,r]);if(n.isDefaultPrevented())f.trigger(u.change,[r,s]);else{s=r;l()}},next:function(){c.go(s+1)},prev:function(){c.go(s-1)},getSlide:function(e){var t=typeof e!="undefined"?e:s;return typeof t!="number"||t<0||t>=i.length?null:i[t]},getSlides:function(){return i},getContainer:function(){return o},getOptions:function(){return a},extend:function(e,t){c[e]=t}};e[t]=function(e,t){return c[e]?c[e].apply(this,Array.prototype.slice.call(arguments,1)):c.init(e,t)};e[t].defaults={classes:{after:"deck-after",before:"deck-before",childCurrent:"deck-child-current",current:"deck-current",loading:"deck-loading",next:"deck-next",onPrefix:"on-slide-",previous:"deck-previous"},selectors:{container:".deck-container"},keys:{next:[13,32,34,39,40],previous:[8,33,37,38]},touch:{swipeTolerance:60}};f.ready(function(){e("html").addClass("ready")});f.bind("deck.change",function(n,r,i){var s=e[t]("getSlide",r).find("iframe"),o=e[t]("getSlide",i).find("iframe");s.each(function(){var t=e(this),n=t.attr("src");n&&t.data("deck-src",n).attr("src","")});o.each(function(){var t=e(this),n=t.data("deck-src");n&&t.attr("src",n)})})})(jQuery,"deck",document);(function(e,t,n,r){var i=e(document),s=e(n),o,u=function(n){var r=n.substr(n.indexOf("#")+1),i=e[t]("getSlides");e.each(i,function(n,i){if(i.attr("id")===r){e[t]("go",n);return!1}});e[t]("getContainer").scrollLeft(0).scrollTop(0)};e.extend(!0,e[t].defaults,{selectors:{hashLink:".deck-permalink"},hashPrefix:"slide-",preventFragmentScroll:!0});i.bind("deck.init",function(){var r=e[t]("getOptions");o=e(),slides=e[t]("getSlides");e.each(slides,function(i,s){var u;if(!s.attr("id")||s.data("deckAssignedId")===s.attr("id")){s.attr("id",r.hashPrefix+i);s.data("deckAssignedId",r.hashPrefix+i)}u="#"+s.attr("id");u===n.location.hash&&e[t]("go",i);o=o.add('a[href="'+u+'"]')});Modernizr.hashchange||o.unbind("click.deckhash").bind("click.deckhash",function(t){u(e(this).attr("href"))});slides.length&&e[t]("getContainer").addClass(r.classes.onPrefix+e[t]("getSlide").attr("id"))}).bind("deck.change",function(r,i,s){var o="#"+e[t]("getSlide",s).attr("id"),u=n.location.href.replace(/#.*/,"")+o,a=e[t]("getOptions"),f=a.classes.onPrefix,l=e[t]("getContainer");l.removeClass(f+e[t]("getSlide",i).attr("id"));l.addClass(f+e[t]("getSlide",s).attr("id"));e(a.selectors.hashLink).attr("href",u);Modernizr.history&&n.history.replaceState({},"",u)});s.bind("hashchange.deckhash",function(e){e.originalEvent&&e.originalEvent.newURL?u(e.originalEvent.newURL):u(n.location.hash)}).bind("load",function(){e[t]("getOptions").preventFragmentScroll&&e[t]("getContainer").scrollLeft(0).scrollTop(0)})})(jQuery,"deck",this);(function(e,t,n){var r=e(document),i;e.extend(!0,e[t].defaults,{classes:{menu:"deck-menu"},keys:{menu:77},touch:{doubletapWindow:400}});e[t]("extend","showMenu",function(){var n=e[t]("getContainer"),r=e[t]("getOptions");if(n.hasClass(r.classes.menu))return;n.addClass([r.classes.loading,r.classes.menu].join(" "));Modernizr.csstransforms&&e.each(i,function(e,t){t.data("oldStyle",t.attr("style"));t.css({position:"absolute",left:e%4*25+"%",top:Math.floor(e/4)*25+"%"})});window.setTimeout(function(){n.removeClass(r.classes.loading).scrollTop(e[t]("getSlide").offset().top)},0)});e[t]("extend","hideMenu",function(){var n=e[t]("getContainer"),r=e[t]("getOptions");if(!n.hasClass(r.classes.menu))return;n.removeClass(r.classes.menu);n.addClass(r.classes.loading);Modernizr.csstransforms&&e.each(i,function(e,t){var n=t.data("oldStyle");t.attr("style",n?n:"")});window.setTimeout(function(){n.removeClass(r.classes.loading).scrollTop(0)},0)});e[t]("extend","toggleMenu",function(){e[t]("getContainer").hasClass(e[t]("getOptions").classes.menu)?e[t]("hideMenu"):e[t]("showMenu")});r.bind("deck.init",function(){var n=e[t]("getOptions"),s=0,o,u=e.map([n.classes.before,n.classes.previous,n.classes.current,n.classes.next,n.classes.after],function(e,t){return"."+e}).join(", ");i=[];e.each(e[t]("getSlides"),function(e,t){t.parentsUntil(n.selectors.container,u).length||i.push(t)});r.unbind("keydown.deckmenu").bind("keydown.deckmenu",function(r){if(r.which===n.keys.menu||e.inArray(r.which,n.keys.menu)>-1){e[t]("toggleMenu");r.preventDefault()}});e[t]("getContainer").unbind("touchstart.deckmenu").bind("touchstart.deckmenu",function(n){o=e[t]("getSlide")}).unbind("touchend.deckmenu").bind("touchend.deckmenu",function(r){var i=Date.now();if(o!==e[t]("getSlide"))return;if(i-s<n.touch.doubletapWindow){e[t]("toggleMenu");r.preventDefault()}s=i});e.each(e[t]("getSlides"),function(r,i){i.unbind("click.deckmenu").bind("click.deckmenu",function(i){if(!e[t]("getContainer").hasClass(n.classes.menu))return;e[t]("go",r);e[t]("hideMenu");i.stopPropagation();i.preventDefault()})})}).bind("deck.change",function(n,r,i){var s=e[t]("getContainer");s.hasClass(e[t]("getOptions").classes.menu)&&s.scrollTop(e[t]("getSlide",i).offset().top)})})(jQuery,"deck");