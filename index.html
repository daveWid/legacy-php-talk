<!doctype html>
<html lang="en">
<head>
	<title>Updating Legacy PHP</title>

	<meta charset="utf-8" />

	<link type="text/css" rel="stylesheet" href="assets/style.css" />

	<script src="assets/jquery-1.7.min.js"></script>
	<script src="assets/modernizr.custom.js"></script>
	<script src="assets/highlight.pack.js"></script>
	<script src="assets/deck.js"></script>
	<script src="assets/script.js"></script>
</head>
<body>
	<article>
		<section class="slide full">
			<h1 class="vcenter">Updating Legacy Code</h1>

			<div class="call-out">
				Dave Widmer<br />
				Web Applications Developer: <span class="bgsu"><strong>BG</strong>SU</span><br />
				@davewidmer
			</div>
		</section>

		<section class="slide full alternate">
			<h1 class="vcenter pink">Back To Basics</h1>
		</section>

		<section class="slide full">
			<h2>What is a Class?</h2>

			<blockquote class="push-down">
				<p>Basic class definitions begin with the keyword class,
					followed by a class name, followed by a pair of curly braces which
					enclose the definitions of the properties and methods belonging to the class.</p>

				<p>The class name can be any valid label which is a not a PHP
					reserved word. A valid class name starts with a letter or underscore,
					followed by any number of letters, numbers, or underscores.
					As a regular expression, it would be expressed thus:
					[a-zA-Z_\x7f-\xff][a-zA-Z0-9_\x7f-\xff]*.</p>

				<p>A class may contain its own constants,
					variables (called "properties"),
					and functions (called "methods"). </p>
			</blockquote>

			<div class="push-down double">
				<div class="row">
					<div class="span6 slide">
						<pre><code class="php">&lt;?php

$var = 'a default value';

function displayVar($var) {
    echo $var;
}
</code></pre>
					</div>
					<div class="span6 slide">
						<pre><code class="php">&lt;?php

class SimpleClass
{
  // property declaration
  public $var = 'a default value';

  // method declaration
  public function displayVar() {
    echo $this->var;
  }
}</code></pre>	
					</div>
				</div>
			</div>
			<div class="call-out resource">
				<a href="http://www.php.net/manual/en/language.oop5.basic.php">
					http://www.php.net/manual/en/language.oop5.basic.php</a>
			</div>
		</section>

		<section class="slide full">
			<h1 class="vcenter lower">$this</h1>
		</section>

		<section class="slide full">
			<h2>Creating a "new" Instance</h2>

			<pre><code class="php">&lt;?php

$instance = new SimpleClass();

$instance->displayVar(); // Outputs 'a default variable'</code></pre>
		</section>

		<section class="slide full">
			<h2>Extending</h2>

			<div class="row">
				<div class="span6">
					<pre><code class="php">&lt;?php

class ExtendClass extends SimpleClass
{
    // Redefine the parent method
    public function displayVar()
    {
        echo "Extending class\n";
        parent::displayVar();
    }
}</code></pre>
				</div>
				<div class="span6">
					<pre><code class="php">&lt;?php

class SimpleClass
{
  // property declaration
  public $var = 'a default value';

  // method declaration
  public function displayVar() {
    echo $this->var;
  }
}</code></pre>
				</div>
			</div>

			<pre class="slide"><code class="php">$extended = new ExtendClass();
$extended->displayVar();
</code></pre>

			<h3 class="slide type-center push-down double">Output?</h3>
		</section>

		<section class="slide full alternate green">
			<h1 class="vcenter green">Public, <span class="pink">Protected</span>, Private</h1>
		</section>

		<section class="slide full">
			<h2>Visibility</h2>

			<pre><code class="php">&lt;?php

class MyClass
{
    public $public = 'Public';
    protected $protected = 'Protected';
    private $private = 'Private';

    public function printHello()
    {
        echo $this->public;
        echo $this->protected;
        echo $this->private;
    }
}</code></pre>

			<pre class="slide"><code class="php">$obj = new MyClass();

echo $obj->public; // Works
echo $obj->protected;// Fatal Error
echo $obj->private; // Fatal Error
</code></pre>

			<h3 class="slide type-center push-down">What about $obj->printHello()?</h3>
			<h3 class="slide type-center push-down">How about extended printHello()?</h3>
		</section>

		<section class="slide full alternate">
			<h1 class="vcenter green">Updating Legacy Code?</h1>
		</section>

		<section class="slide full">
			<h2>Who Wants a Beer?</h2>

			<pre class="slide"><code class="php">if ( ! function_exists('random_beer'))
{
  function random_beer()
  {
    $beers = array(
      'Natural Light',
      'Sam Adams',
      'Bells'
    );

    $random = rand(0, (count($beers) - 1));
    return $beers[$random];
  }
}</code></pre>
	
		</section>

		<section class="slide full alternate">
			<h1 class="vcenter green">Where do you keep this?</h1>
		</section>

		<section class="slide full alternate">
			<h1 class="vcenter alt pink">How do you find it again?</h1>
		</section>

		<section class="slide full">
			<h2>BeerHelper.php to the Rescue!</h2>

			<div class="row">
				<div class="span5">
					<pre><code class="php">if ( ! function_exists('random_beer'))
{
  function random_beer()
  {
    $beers = array(
      'Natural Light',
      'Sam Adams',
      'Bells'
    );

    $random = rand(0, (count($beers) - 1));
    return $beers[$random];
  }
}</code></pre>
				</div>
				<div class="span2">
					<h2 class="type-center push-down double">=></h2>
				</div>
				<div class="span5">
					<pre><code class="php">&lt;?php

class BeerHelper
{
  public static function random()
  {
    $beers = array(
      'Natural Light',
      'Sam Adams',
      'Bells'
    );

    $random = rand(0, (count($beers) - 1));
    return $beers[$random];
  }
}</code></pre>
				</div>
			</div>

			<div class="slide">
				<h3>Use</h3>

				<pre><code class="php">include "BeerHelper.php";

$giveMeA = BeerHelper::random();</code></pre>
			</div>
		</section>

		<section class="slide full alternate">
			<h1 class="vcenter green">Examples</h1>
		</section>

		<section class="slide full">
			<h2>FTP Uploads</h2>

			<pre><code class="php">// file to ftp
$file = $_FILES['userfile']['name'];
$filetype=$_FILES["userfile"]["type"];

if($filetype != "application/msword" and $filetype != "application/pdf") {
	die('Invalid file, click &lt;a href="./index.php?error=INV_FILE_EXT">here&lt;/a> to retry!');
}
$ftp_path = '/data/' . $file;

// FTP credentials
$host = 'HOST';
$user = 'USER';
$pswd = 'PASS';

// connect to FTP server (port 21)
$c_id = ftp_connect($host, 21) or die("Cannot connect to host");

// send access parameters
ftp_login($c_id, $user, $pswd) or die("Cannot login");

// do the file upload
$upload = ftp_put($c_id, $ftp_path, $file, FTP_ASCII);

// check to see if upload was successful
print (!$upload) ? 'Cannot upload' : 'Upload complete';
print "\n";

// close the FTP session
ftp_close($c_id);</code></pre>
		</section>

		<section class="slide full">
			<h2>OOP FTPUpload</h2>
			<div class="row">
				<div class="span8">
					<pre><code class="php">class FTPUpload
{
  private $file;
  private $id = null;

  public function __construct(array $file, array $config)
  {
    $this->file = $file;
    $this->id = ftp_connect($config['host']) or die('Cannot connect to host');
    ftp_login($this->id, $config['user'], $config['password']) or die("Cannot login");
  }

  public function isValid()
  {
    $valid = array('application/msword','application/pdf');
    return in_array($this->file['filetype'], $valid);
  }

  public function upload($path)
  {
    return ftp_put($this->id, $path, $this->file['filename'], FTP_ASCII);
  }

  public function __destruct()
  {
    if ($this->id !== null) {
      ftp_close($this->id);
    }
  }
}</code></pre>
				</div>
				<div class="span4">
					<h3>Use</h3>
					<pre><code class="php">$config = array(
  'host' => "HOST",
  'user' => "USER",
  'password' => "PASSWORD"
);

$file = $_FILE['userfile'];
$ftp = new FTPUpload($file, $config);

if ( ! $ftp->isValid()) {
  // Send user error
}

$success = $ftp->upload("/data/");

if ($success) {
  echo "Success";
} else {
  echo "Error";
}</code></pre>
				</div>
			</div>
		</section>

		<section class="slide full">
			<h2>On Your Own</h2>
			<ul>
				<li>Constructors and Destructors</li>
				<li>Magic Methods</li>
				<li>Autoloading</li>
				<li>Abstraction</li>
				<li>Interfaces</li>
				<li>Namespaces (5.3+)</li>
				<li>Traits (5.4+)</li>
			</ul>

			<h2>Resources</h2>
			<ul>
				<li><a href="http://www.php.net">PHP.net</a></li>
				<li><a href="http://www.phptherightway.com/">PHP the Right Way</a></li>
				<li><a href="http://www.php-fig.org/">PHP FIG</a></li>
			</ul>
		</section>
	</article>

	<script src="assets/presentation.js"></script>
</body>
</html>
